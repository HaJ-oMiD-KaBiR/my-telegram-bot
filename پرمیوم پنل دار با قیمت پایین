from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters

TOKEN = '7746893979:AAFEtrJdh0lTbzX5W14M8So-AlVHrliB3lk'

PHOTO_URL = "https://ibb.co/3YRhQwC7"

WALLET_ADDRESS = "TAThTmtJPRjH13Zcd6PHDfJU85V2S4jjnQ"

TEXTS = {
    'en': {
        'select_language': 'Select the language of the bot.',
        'premium_message': 'Telegram Premium Subscription\n\nGo beyond the limits, get exclusive features and support the development of Telegram by subscribing to Telegram Premium.\n\nğŸ“ŒPlease select your subscription duration.',
        '1_month': '1 Month',
        '3_months': '3 Months',
        '6_months': '6 Months',
        '1_year': '1 Year',
        'payment_message': 'Please transfer the amount above in USDT (TRC20) to the wallet address below to activate Telegram Premium.\n\nğŸ“Œ Please complete the payment using the button below and restart the bot with /start.\n\nâš ï¸ If you experience issues, manually send the amount to the wallet address below, take a screenshot of the transaction, and send it in this bot.',
        'prices': {
            '1_month': 6.0,
            '3_months': 11.0,
            '6_months': 15.0,
            '1_year': 27.0
        }
    },
    'fa': {
        'select_language': 'Ø²Ø¨Ø§Ù† Ø±Ø¨Ø§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.',
        'premium_message': 'Ø§Ø´ØªØ±Ø§Ú© ØªÙ„Ú¯Ø±Ø§Ù… Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…\n\nØ¨Ø§ Ø§Ø´ØªØ±Ø§Ú© ØªÙ„Ú¯Ø±Ø§Ù… Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…ØŒ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ ÙØ±Ø§ØªØ± Ø¨Ø±ÙˆÛŒØ¯ØŒ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø­ØµØ§Ø±ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø² ØªÙˆØ³Ø¹Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø­Ù…Ø§ÛŒØª Ú©Ù†ÛŒØ¯.\n\nğŸ“ŒÙ„Ø·ÙØ§Ù‹ Ù…Ø¯Øª Ø§Ø´ØªØ±Ø§Ú© Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.',
        '1_month': 'Û± Ù…Ø§Ù‡Ù‡',
        '3_months': 'Û³ Ù…Ø§Ù‡Ù‡',
        '6_months': 'Û¶ Ù…Ø§Ù‡Ù‡',
        '1_year': 'Û± Ø³Ø§Ù„Ù‡',
        'payment_message': 'ğŸ’° Ù…Ø¨Ù„Øº ÙÙˆÙ‚ Ø±Ø§ Ø¨Ù‡ USDT (TRC20) Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø²ÛŒØ± Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ù‡ÛŒØ¯ ØªØ§ Ø§Ø´ØªØ±Ø§Ú© ØªÙ„Ú¯Ø±Ø§Ù… Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ… Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø´ÙˆØ¯.\n\nğŸ“Œ Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯ Ùˆ Ø±Ø¨Ø§Øª Ø±Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ /start Ú©Ù†ÛŒØ¯.\n\nâš ï¸ Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø®ØªØŒ Ù…Ø¨Ù„Øº Ø±Ø§ Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ØŒ Ø¹Ú©Ø³ Ø§Ø² ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ùˆ Ø¯Ø± Ù‡Ù…ÛŒÙ† Ø±Ø¨Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ù†Ù…Ø§ÛŒÛŒØ¯.',
        'prices': {
            '1_month': 6.0,
            '3_months': 11.0,
            '6_months': 15.0,
            '1_year': 27.0
        }
    },
    'ru': {
        'select_language': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº Ğ±Ğ¾Ñ‚Ğ°.',
        'premium_message': 'ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° Telegram Premium\n\nĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ ÑĞºÑĞºĞ»ÑĞ·Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ Telegram, Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ğ² Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ Ğ½Ğ° Telegram Premium.\n\nğŸ“ŒĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑÑ€Ğ¾Ğº Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸.',
        '1_month': '1 Ğ¼ĞµÑÑÑ†',
        '3_months': '3 Ğ¼ĞµÑÑÑ†Ğ°',
        '6_months': '6 Ğ¼ĞµÑÑÑ†ĞµĞ²',
        '1_year': '1 Ğ³Ğ¾Ğ´',
        'payment_message': 'ğŸ’° ĞŸĞµÑ€ĞµĞ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½ÑƒÑ ÑÑƒĞ¼Ğ¼Ñƒ Ğ² USDT (TRC20) Ğ½Ğ° ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ½Ğ¸Ğ¶Ğµ ĞºĞ¾ÑˆĞµĞ»ĞµĞº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Telegram Premium.\n\nğŸ“Œ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ /start.\n\nâš ï¸ Ğ•ÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ½ÑƒÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¾Ğ¹, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ ÑÑƒĞ¼Ğ¼Ñƒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ½Ğ° ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ½Ğ¸Ğ¶Ğµ ĞºĞ¾ÑˆĞµĞ»ĞµĞº, ÑĞ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ ĞµĞ³Ğ¾ Ğ² ÑÑ‚Ğ¾Ñ‚ Ğ±Ğ¾Ñ‚.',
        'prices': {
            '1_month': 6.0,
            '3_months': 11.0,
            '6_months': 15.0,
            '1_year': 27.0
        }
    },
    'ar': {
        'select_language': 'Ø§Ø®ØªØ± Ù„ØºØ© Ø§Ù„Ø¨ÙˆØª.',
        'premium_message': 'Ø§Ø´ØªØ±Ø§Ùƒ Telegram Premium\n\nØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ÙˆØ¯ØŒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ© ÙˆØ¯Ø¹Ù… ØªØ·ÙˆÙŠØ± Telegram Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Telegram Premium.\n\nğŸ“ŒØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.',
        '1_month': '1 Ø´Ù‡Ø±',
        '3_months': '3 Ø£Ø´Ù‡Ø±',
        '6_months': '6 Ø£Ø´Ù‡Ø±',
        '1_year': '1 Ø³Ù†Ø©',
        'payment_message': 'ğŸ’° Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø£Ø¹Ù„Ø§Ù‡ Ø¨Ø¹Ù…Ù„Ø© USDT (TRC20) Ø¥Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ Telegram Premium.\n\nğŸ“Œ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù…Ø± /start.\n\nâš ï¸ Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡ØªÙƒ Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„ØŒ Ù‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£Ø¯Ù†Ø§Ù‡ØŒ ÙˆØ§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© Ù„Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ£Ø±Ø³Ù„Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª.',
        'prices': {
            '1_month': 6.0,
            '3_months': 11.0,
            '6_months': 15.0,
            '1_year': 27.0
        }
    }
}

ADMINS = {
    6270876509: "Owner",  
}

users_started = set()

active_users = {}

def generate_payment_link(amount):
    return f"https://link.trustwallet.com/send?asset=c8d2a6ad&address={WALLET_ADDRESS}&amount={amount}"

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    users_started.add(user_id)
    active_users[user_id] = active_users.get(user_id, 0) + 1

    keyboard = [
        [InlineKeyboardButton("English ğŸ‡¬ğŸ‡§", callback_data='en')],
        [InlineKeyboardButton("Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º", callback_data='ru')],
        [InlineKeyboardButton("ÙØ§Ø±Ø³ÛŒ ğŸ‡®ğŸ‡·", callback_data='fa')],
        [InlineKeyboardButton("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦", callback_data='ar')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(TEXTS['en']['select_language'], reply_markup=reply_markup)

async def language_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    lang = query.data
    await query.answer()
    await query.message.delete()

    keyboard = [
        [
            InlineKeyboardButton(TEXTS[lang]['1_month'], callback_data=f'1_month_{lang}'),
            InlineKeyboardButton(TEXTS[lang]['3_months'], callback_data=f'3_months_{lang}')
        ],
        [
            InlineKeyboardButton(TEXTS[lang]['6_months'], callback_data=f'6_months_{lang}'),
            InlineKeyboardButton(TEXTS[lang]['1_year'], callback_data=f'1_year_{lang}')
        ]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    caption = TEXTS[lang]['premium_message']

    await context.bot.send_photo(
        chat_id=query.message.chat.id,
        photo=PHOTO_URL,
        caption=caption,
        reply_markup=reply_markup
    )

async def price_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    data = query.data
    await query.answer()

    try:
        parts = data.split('_')
        if len(parts) == 3:  # Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ 1_month, 3_months, 6_months, 1_year
            duration, unit, lang = parts
            duration_key = f"{duration}_{unit}"
        else:
            raise ValueError("Invalid data format")

        if duration_key not in TEXTS[lang]['prices']:
            raise ValueError("Invalid duration")

        price = TEXTS[lang]['prices'][duration_key]
        payment_link = generate_payment_link(price)

        keyboard = [[InlineKeyboardButton("USDT (TRC20) Trust Wallet ğŸ’³", url=payment_link)]]
        reply_markup = InlineKeyboardMarkup(keyboard)

        payment_message = f"ğŸ’° Price : {price} USDT (TRC20)\n\n{TEXTS[lang]['payment_message']}\n\nğŸ“Œ Wallet address:\n`{WALLET_ADDRESS}`"

        await context.bot.send_message(
            chat_id=query.message.chat.id,
            text=payment_message,
            reply_markup=reply_markup
        )

    except Exception as e:
        await query.message.reply_text("âš ï¸ An error occurred, please try again.")
        print(f"Error: {e}")

async def omid_panel(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    if user_id not in ADMINS:
        await update.message.reply_text("You are not authorized to use this command.")
        return

    keyboard = [
        [InlineKeyboardButton("â‰ï¸ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†", callback_data='user_count')],
        [InlineKeyboardButton("â­Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„", callback_data='active_users')],
        [InlineKeyboardButton("ğŸŒÙ¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ", callback_data='broadcast')],
        [InlineKeyboardButton("â•Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¯ÛŒØ±", callback_data='add_admin')],
        [InlineKeyboardButton("â–Ø­Ø°Ù Ù…Ø¯ÛŒØ±", callback_data='remove_admin')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("Hello, dear administrator, welcome to the robot ğŸ‘‘", reply_markup=reply_markup)

async def handle_admin_actions(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    data = query.data
    await query.answer()

    if data == 'user_count':
        await query.message.reply_text(f"ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: {len(users_started)}")
    elif data == 'active_users':
        active_users_list = []
        for user_id, count in active_users.items():
            user = await context.bot.get_chat(user_id)
            username = user.username if user.username else f"User ID: {user_id}"
            active_users_list.append(f"{username}, Activity: {count}")
        await query.message.reply_text(f"Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„:\n" + "\n".join(active_users_list))
    elif data == 'broadcast':
        await query.message.reply_text("âœ…Ù„Ø·ÙØ§Ù‹ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.")
        context.user_data['awaiting_broadcast'] = True
    elif data == 'add_admin':
        await query.message.reply_text("âœ…Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ù…Ø¯ÛŒØ± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.")
        context.user_data['awaiting_admin_id'] = True
    elif data == 'remove_admin':
        keyboard = [[InlineKeyboardButton(admin, callback_data=f"remove_{admin_id}")] for admin_id, admin in ADMINS.items() if admin_id != 6270876509]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.message.reply_text("ğŸ”Ø§Ø¯Ù…ÛŒÙ†ÛŒ Ú©Ù‡ Ù‚ØµØ¯ Ø¯Ø§Ø±ÛŒØ¯ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", reply_markup=reply_markup)
    elif data.startswith('remove_'):
        admin_id = int(data.split('_')[1])
        if admin_id in ADMINS:
            del ADMINS[admin_id]
            await query.message.reply_text(f"âŒØ§Ø¯Ù…ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.")
        else:
            await query.message.reply_text("âŒØ§ÛŒÙ† Ø¢ÛŒØ¯ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª Ù…Ø¯ÛŒØ±Ø§Ù† ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.")

async def add_admin(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    if user_id not in ADMINS:
        await update.message.reply_text("You are not authorized to use this command.")
        return

    admin_id = int(update.message.text)
    ADMINS[admin_id] = "Admin"
    await update.message.reply_text(f" âœ…Ù…Ø¯ÛŒØ± Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ {admin_id} Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯.")

async def broadcast_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    if user_id not in ADMINS:
        await update.message.reply_text("You are not authorized to use this command.")
        return

    message = update.message.text
    for user in users_started:
        try:
            await context.bot.send_message(chat_id=user, text=message)
        except Exception as e:
            print(f"Error sending message to {user}: {e}")
    await update.message.reply_text("âœ… Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")

def main():
    application = Application.builder().token(TOKEN).build()

    application.add_handler(CommandHandler('start', start))
    application.add_handler(CallbackQueryHandler(language_selection, pattern='^(en|ru|fa|ar)$'))
    application.add_handler(CallbackQueryHandler(price_selection, pattern='^\d+_(month|months|year)_(en|ru|fa|ar)$'))
    application.add_handler(CommandHandler('omid', omid_panel))
    application.add_handler(CallbackQueryHandler(handle_admin_actions))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, add_admin))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, broadcast_message))

    application.run_polling()

if __name__ == '__main__':
    main()